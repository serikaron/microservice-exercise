version: "3.7"
services:
  chat:
    build:
      context: $PROJECT_ROOT
      dockerfile: scripts/docker/chat.dockerfile
    image: $DOCKER_REGISTRY/chat
    env_file:
      - .env
    depends_on:
      - redis
    entrypoint: /chat --chat-port $chat_port --chat-host "" --redis-port $redis_port --cert-path $cert_path --integration-test-enable --integration-test-key "integration-test-key"

  chat-test:
    build:
      context: $PROJECT_ROOT
      dockerfile: scripts/docker/chat.test.dockerfile
    image: $DOCKER_REGISTRY/chat-test
    env_file:
      - .env
    depends_on:
      - chat
    entrypoint: /chat-test --chat-port=$chat_port --cert-path $cert_path --integration-test-key "integration-test-key"

  redis:
    image: redis:alpine